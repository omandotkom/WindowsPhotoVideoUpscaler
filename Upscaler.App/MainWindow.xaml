<Window x:Class="Upscaler.App.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="Upscaler" Height="860" Width="1240" MinHeight="720" MinWidth="1100"
        Icon="Assets/icon-magnifier.png">
    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVisibility" />
    </Window.Resources>
    <Window.Background>
        <SolidColorBrush Color="White" />
    </Window.Background>
    <Grid Margin="24">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <Border Grid.Row="0"
                CornerRadius="12"
                BorderThickness="1"
                BorderBrush="#D0D7DE"
                Background="#F6F8FA"
                Padding="18"
                AllowDrop="True"
                DragOver="DropZone_OnDragOver"
                Drop="DropZone_OnDrop"
                IsHitTestVisible="{Binding IsUiEnabled}">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                <StackPanel>
                    <TextBlock Text="Drop images or folders here" FontSize="20" FontWeight="SemiBold" Foreground="#0F172A" />
                    <TextBlock Text="Supported: jpg, png, webp, bmp, tiff, mp4, mov, mkv, avi, webm, 3gp" Foreground="#475569" Margin="0,6,0,0" />
                </StackPanel>
                <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                    <Button Content="Open Files" Command="{Binding OpenFilesCommand}" Margin="0,0,8,0" Padding="16,8" />
                    <Button Content="Open Folder" Command="{Binding OpenFolderCommand}" Padding="16,8" />
                </StackPanel>
            </Grid>
        </Border>

        <Grid Grid.Row="1" Margin="0,18,0,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="380" />
                <ColumnDefinition Width="16" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>

            <ScrollViewer Grid.Column="0" VerticalScrollBarVisibility="Auto">   
                <StackPanel IsHitTestVisible="{Binding IsUiEnabled}">
                    <GroupBox Header="Inputs" Margin="0,0,0,12" Foreground="#0F172A" BorderBrush="#D0D7DE">
                        <StackPanel Margin="8">
                            <TextBlock Text="Selected files" Foreground="#475569" />
                            <ListBox ItemsSource="{Binding SelectedFiles}" Height="120" Margin="0,6,0,10" />
                            <TextBlock Text="{Binding JobProgressText}" Foreground="#334155" />
                        </StackPanel>
                    </GroupBox>

                    <GroupBox Header="Model" Margin="0,0,0,12" Foreground="#0F172A" BorderBrush="#D0D7DE">
                        <StackPanel Margin="8">
                            <ComboBox ItemsSource="{Binding Models}"
                                      SelectedItem="{Binding SelectedModel}"
                                      DisplayMemberPath="Name"
                                      Margin="0,0,0,8" />
                            <TextBlock Text="{Binding ModelStatus}" Foreground="#475569" Margin="0,0,0,6" />
                            <TextBlock Text="{Binding DeviceStatus}" Foreground="#64748B" Margin="0,0,0,10" />
                            <Button Content="Download Model"
                                    Command="{Binding DownloadModelCommand}"
                                    Visibility="{Binding IsSelectedModelMissing, Converter={StaticResource BoolToVisibility}}"
                                    Padding="12,6" />
                            <Button Content="Redownload Model"
                                    Command="{Binding RedownloadModelCommand}"
                                    Visibility="{Binding IsSelectedModelAvailable, Converter={StaticResource BoolToVisibility}}"
                                    Padding="12,6"
                                    Margin="0,6,0,0" />
                            <ProgressBar Height="8" Margin="0,8,0,0" Value="{Binding DownloadProgressPercent, Mode=OneWay}" />
                            <TextBlock Text="{Binding DownloadProgressText}" Foreground="#475569" Margin="0,6,0,0" />
                        </StackPanel>
                    </GroupBox>

                    <GroupBox Header="Settings" Margin="0,0,0,12" Foreground="#0F172A" BorderBrush="#D0D7DE">
                        <StackPanel Margin="8">
                            <TextBlock Text="Scale" Foreground="#475569" />
                            <ComboBox ItemsSource="{Binding Scales}" SelectedItem="{Binding SelectedScale}" Margin="0,4,0,8" />
                            <TextBlock Text="{Binding SuggestedScale}" Foreground="#334155" Margin="0,0,0,8" />

                            <TextBlock Text="Quality preset" Foreground="#475569" />
                            <ComboBox ItemsSource="{Binding QualityPresets}" SelectedItem="{Binding SelectedQualityPreset}" Margin="0,4,0,8" />

                            <TextBlock Text="Mode" Foreground="#475569" />
                            <ComboBox ItemsSource="{Binding Modes}" SelectedItem="{Binding SelectedMode}" Margin="0,4,0,8" />

                            <TextBlock Text="Output folder" Foreground="#475569" />
                            <DockPanel Margin="0,4,0,8">
                                <TextBox Text="{Binding OutputFolder}" Width="240" />
                                <Button Content="Browse" Command="{Binding BrowseOutputFolderCommand}" Margin="8,0,0,0" Padding="10,4" />
                            </DockPanel>

                            <TextBlock Text="Output format" Foreground="#475569" />
                            <ComboBox ItemsSource="{Binding OutputFormats}" SelectedItem="{Binding SelectedOutputFormat}" Margin="0,4,0,8" />

                            <TextBlock Text="Video encoding" Foreground="#475569" />
                            <ComboBox ItemsSource="{Binding VideoEncoders}" SelectedItem="{Binding SelectedVideoEncoder}" Margin="0,4,0,8" />
                            <CheckBox Content="Use hardware decode (if available)" IsChecked="{Binding UseHardwareDecode}" Foreground="#334155" Margin="0,0,0,8" />

                            <TextBlock Text="JPEG quality" Foreground="#475569" />
                            <DockPanel Margin="0,4,0,8">
                                <Slider Minimum="1" Maximum="100" Value="{Binding JpegQuality}" Width="200" />
                                <TextBlock Text="{Binding JpegQuality}" Foreground="#334155" Margin="8,0,0,0" VerticalAlignment="Center" />
                            </DockPanel>

                            <CheckBox Content="Skip duplicates by hash" IsChecked="{Binding SkipDuplicates}" Foreground="#334155" Margin="0,0,0,8" />
                            <CheckBox Content="Denoise (reduce noise before upscale)" IsChecked="{Binding EnableDenoise}" Foreground="#334155" Margin="0,0,0,6" />
                            <DockPanel Margin="0,0,0,8" IsEnabled="{Binding IsDenoiseEnabled}">
                                <Slider Minimum="0" Maximum="0.5" Value="{Binding DenoiseStrength}" Width="200" />
                                <TextBlock Text="{Binding DenoiseStrength, StringFormat=F2}" Foreground="#334155" Margin="8,0,0,0" VerticalAlignment="Center" />
                            </DockPanel>
                            <CheckBox Content="Temporal smoothing (frame sequences)" IsChecked="{Binding EnableTemporalBlend}" Foreground="#334155" Margin="0,0,0,6" />
                            <DockPanel Margin="0,0,0,8" IsEnabled="{Binding IsTemporalBlendEnabled}">
                                <Slider Minimum="0" Maximum="0.5" Value="{Binding TemporalBlendStrength}" Width="200" />
                                <TextBlock Text="{Binding TemporalBlendStrength, StringFormat=F2}" Foreground="#334155" Margin="8,0,0,0" VerticalAlignment="Center" />
                            </DockPanel>

                            <Expander Header="Advanced tiling" Foreground="#0F172A">
                                <StackPanel Margin="0,6,0,0">
                                    <TextBlock Text="Tile size" Foreground="#475569" />
                                    <TextBox Text="{Binding TileSizeText}" Margin="0,4,0,6" />
                                    <TextBlock Text="Overlap" Foreground="#475569" />
                                    <TextBox Text="{Binding TileOverlapText}" Margin="0,4,0,0" />
                                </StackPanel>
                            </Expander>
                        </StackPanel>
                    </GroupBox>

                    <GroupBox Header="Actions" Margin="0,0,0,12" Foreground="#0F172A" BorderBrush="#D0D7DE">
                        <StackPanel Margin="8">
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                <Button Content="Preview" Command="{Binding PreviewCommand}" Margin="0,0,8,0" Padding="14,6" />
                                <Button Content="Upscale" Command="{Binding UpscaleCommand}" Margin="0,0,8,0" Padding="14,6" />
                                <Button Content="Cancel" Command="{Binding CancelCommand}" Padding="14,6" />
                            </StackPanel>
                            <ProgressBar Height="8" Margin="0,0,0,6" Value="{Binding UpscaleProgressPercent, Mode=OneWay}" />
                            <TextBlock Text="{Binding JobProgressText}" Foreground="#334155" />
                        </StackPanel>
                    </GroupBox>

                    <GroupBox Header="Recent outputs" Foreground="#0F172A" BorderBrush="#D0D7DE">
                        <StackPanel Margin="8">
                            <ListBox ItemsSource="{Binding RecentOutputs}" Height="120" />
                        </StackPanel>
                    </GroupBox>
                </StackPanel>
            </ScrollViewer>

            <Border Grid.Column="2" CornerRadius="16" Background="#FFFFFF" BorderBrush="#D0D7DE" BorderThickness="1" Padding="16">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>
                    <StackPanel>
                        <TextBlock Text="Preview" FontSize="18" FontWeight="SemiBold" Foreground="#0F172A" />
                        <TextBlock Text="{Binding PreviewInfo}" Foreground="#64748B" Margin="0,4,0,0" />
                    </StackPanel>
                    <Border Grid.Row="1" Margin="0,16,0,0" Background="#F8FAFC" CornerRadius="12" BorderBrush="#E2E8F0" BorderThickness="1">
                        <Viewbox Stretch="Uniform">
                            <Image Source="{Binding PreviewImage}" />
                        </Viewbox>
                    </Border>
                </Grid>
            </Border>
        </Grid>
    </Grid>
</Window>
